#!/bin/sh

INSTALLPREFIX=@CMAKE_INSTALL_PREFIX@

OWLISP2C=${INSTALLPREFIX}/bin/owlisp2c
CC=clang
CFLAGS=-I${INSTALLPREFIX}/include
LDFLAGS=-L${INSTALLPREFIX}/lib
LIBS=-lowlisprt

while getopts "hc:o:" opt; do
	case "$opt" in
	h)
		echo "HELP"
		exit 0
		;;
	c)
		INFILE="${OPTARG}"
		;;
	o)
		OUTFILE="${OPTARG}"
		;;
	esac
done

if [ -z "${INFILE}" -o -z "${OUTFILE}" ]; then
	echo "both infile and outfile must be provided"
	exit 1
fi

COUTFILE="${INFILE}.c"
OBJOUTFILE="${INFILE}.o"

${OWLISP2C} <"${INFILE}" >"${COUTFILE}"

${CC} -Wall ${CFLAGS} -o "${OBJOUTFILE}" -c "${COUTFILE}"
${CC} -Wall ${LDFLAGS} -o "${OUTFILE}" ${OBJOUTFILE} ${LIBS}

